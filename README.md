---

### How to Fix the Feather/Monero Trezor Build Failure on OpenBSD

**The Problem:**
When compiling Feather Wallet (or Monero) on OpenBSD, the build will fatally fail around 15% during the `obj_device_trezor` compilation phase.

The error logs will point to `messages-monero.pb.h` and complain about expected member names or syntax errors around `::uint32_t minor() const;`.

This happens because OpenBSD defines `major` and `minor` as preprocessor macros in `<sys/types.h>`. When the Google Protocol Buffer compiler (`protoc`) generates the C++ headers for Trezor hardware wallets, it creates class methods named `minor()`. The C preprocessor blindly replaces these method names with the system macros, completely destroying the C++ syntax.

**The Solution:**
Because the problematic header file is auto-generated by CMake/Make, you cannot patch it beforehand. You have to let the build generate the file, inject the fix, and then resume the build.

**Step-by-Step Instructions:**

**1. Configure your build normally**
Run your standard `cmake` configuration command inside your `build` directory.

**2. Start the build**
Run `make`. Let it compile until it inevitably hits the fatal error around 15% and halts.

**3. Inject the macro undefines**
Now that the auto-generated protobuf files exist, run this `perl` command from your terminal. It surgically inserts `#undef minor` and `#undef major` exactly where they are needed in the file so that other `#include` statements can't bring the macros back:

```bash
# Note: Adjust the path if your source directory is structured differently
perl -pi -e 's/^(.*minor\(\) const.*)/#undef minor\n#undef major\n$1/g' ../monero/src/device_trezor/trezor/messages/messages-monero.pb.h

```

**4. Resume the build**
Do **not** run `make clean` or re-run `cmake`, or you will overwrite the file you just patched. Just run `make` again:

```bash
make

```

The compiler will pick up right where it left off, successfully compile the Trezor device objects, and finish the rest of the build.

---

Would you like me to help you package this up into an actual `.patch` file format for the Monero/Feather upstream, or are you good to go with sharing this guide?
